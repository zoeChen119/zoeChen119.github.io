<!DOCTYPE html><html lang="zh-CN" data-mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="记录：联通2022网络AI技能大赛" /><meta property="og:locale" content="zh_CN" /><meta name="description" content="中国联通2022网络AI技能大赛复赛赛题（NLP赛道）" /><meta property="og:description" content="中国联通2022网络AI技能大赛复赛赛题（NLP赛道）" /><link rel="canonical" href="https://zoechen119.github.io/posts/%E8%AE%B0%E5%BD%95-%E8%81%94%E9%80%9A2022%E7%BD%91%E7%BB%9CAI%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B/" /><meta property="og:url" content="https://zoechen119.github.io/posts/%E8%AE%B0%E5%BD%95-%E8%81%94%E9%80%9A2022%E7%BD%91%E7%BB%9CAI%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B/" /><meta property="og:site_name" content="zoe Chen" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-09-20T14:10:56+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="记录：联通2022网络AI技能大赛" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-09-27T18:00:54+08:00","datePublished":"2022-09-20T14:10:56+08:00","description":"中国联通2022网络AI技能大赛复赛赛题（NLP赛道）","headline":"记录：联通2022网络AI技能大赛","mainEntityOfPage":{"@type":"WebPage","@id":"https://zoechen119.github.io/posts/%E8%AE%B0%E5%BD%95-%E8%81%94%E9%80%9A2022%E7%BD%91%E7%BB%9CAI%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B/"},"url":"https://zoechen119.github.io/posts/%E8%AE%B0%E5%BD%95-%E8%81%94%E9%80%9A2022%E7%BD%91%E7%BB%9CAI%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B/"}</script><title>记录：联通2022网络AI技能大赛 | zoe Chen</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="zoe Chen"><meta name="application-name" content="zoe Chen"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/avatar.jfif" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">zoe Chen</a></div><div class="site-subtitle font-italic">nlper, dler, sims4er</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>首页</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>分类</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>标签</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>归档</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>关于</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/zoeChen119" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['zoe9698','163.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> 首页 </a> </span> <span>记录：联通2022网络AI技能大赛</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> 文章</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="搜索..."> </span> <span id="search-cancel" >取消</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>记录：联通2022网络AI技能大赛</h1><div class="post-meta text-muted"> <span> 发表于 <em class="" data-ts="1663654256" data-df="YYYY-MM-DD" data-toggle="tooltip" data-placement="bottom"> 2022-09-20 </em> </span> <span> 更新于 <em class="" data-ts="1664272854" data-df="YYYY-MM-DD" data-toggle="tooltip" data-placement="bottom"> 2022-09-27 </em> </span><div class="d-flex justify-content-between"> <span> 作者 <em> <a href="https://github.com/zoeChen119">陈政伊</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="4242 字"> <em>23 分钟</em>阅读</span></div></div></div><div class="post-content"><h1 id="中国联通2022网络ai技能大赛复赛赛题nlp赛道">中国联通2022网络AI技能大赛复赛赛题（NLP赛道）</h1><ul><li><h2 id="简介"><span class="mr-2">简介</span><a href="#简介" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></ul><p>任务：用户评论情感分类</p><p>赛题意义：从①各大网站的用户评论区中；②用户和客服的聊天记录中，挖掘用户的情绪。</p><p>数据集：本赛题需要参赛者解决的是文本情感分类问题。由于运营商的工单含有运营商用户敏感信息，基于公司用户隐私相关规范，本次比赛暂不提供真实用户数据，所以我们选取了<u>外卖、酒店、旅游、美食评论、电影评论等多个生活中常用的领域第三方APP下的评论数据</u>作为本次赛题的数据集。</p><p>输入输出形式： input:一段文字 output：1|0（其中“积极”用1表示，“消极”用0表示）</p><p>内容格式： 每一句是一个单独的一行。 review是用户评论数据，rating字段是输出。</p><p>文件格式： csv</p><p>数据分类：</p><ol><li><p>电影评论 movie_train.csv movie_train.csv的字段名称为：userId,movieId,rating,timestamp,comment,like，分别代表用户ID，电影ID，用户评分（只保留1和5分的记录，其中5分是积极，1分是消极），评分时间戳，评论内容，是否喜欢等。 数据量：663226条</p><li><p>用户购物消费评论 shopping_train.csv shopping_train.csv的字段名称为：cat（物品类型）、label（评分0-1）、review（评论文字） 数据量：50219条</p><li><p>用户外卖评论 waimai_train.csv waimai_train.csv的字段名称为：label（评分0-1）、review（评论文字） 数据量：9589条</p></ol><p>注：由于训练集中的数据形式不一样，<strong>需要用户自行进行统一处理后送入模型训练</strong>。</p><p>数据集中可能存在缺失、重复、脏数据、换行等少部分干扰数据，需要参赛者自己<strong>构建策略予以识别或者滤除</strong>。</p><p>评分标准：按照准确率的<strong>F1值</strong>从高到低进行排名。</p><p>提交结果格式： <strong>提交的答案形式也是csv形式，以标题栏为label，然后用1和0表示积极和消极即可。</strong> 例如在如下例子中：</p><div class="table-wrapper"><table><thead><tr><th>label<tbody><tr><td>0<tr><td>1<tr><td>0<tr><td>1<tr><td>0<tr><td>1</table></div><p>代表第1、3、5句识别结果是消极情绪，第2、4、6句识别结果是积极情绪。</p><p>:trollface:</p><font color="DarkCyan"> 使用到的优化方法： 1. Word2Vec+TFIDF提取关键词，以便于数据增强时替换词语不替换掉关键词 2. 数据增强：基于同义词词林替换词语 3. 调整交叉熵分类的阈值 4. 使用SKEP模型微调 </font><hr /><ul><li><h2 id="数据预处理可视化分析"><span class="mr-2">数据预处理&amp;可视化分析</span><a href="#数据预处理可视化分析" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="1-数据可视化"><span class="mr-2">1. 数据可视化</span><a href="#1-数据可视化" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>训练集1 movie_train.csv 概况</p></ul><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>

<span class="n">movie_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"../train/movie_train.csv"</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">","</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">movie_df</span><span class="p">))</span>

<span class="n">key</span> <span class="o">=</span> <span class="s">"comment"</span>
<span class="n">key_len</span> <span class="o">=</span> <span class="n">key</span><span class="o">+</span><span class="s">"_len"</span>
<span class="n">movie_df</span><span class="p">[</span><span class="n">key_len</span><span class="p">]</span><span class="o">=</span><span class="n">movie_df</span><span class="p">[</span><span class="n">key</span><span class="p">].</span><span class="nb">apply</span><span class="p">(</span><span class="nb">len</span><span class="p">)</span>
<span class="c1"># 查看comment文本情况
</span><span class="k">print</span><span class="p">(</span><span class="s">"数据长度概览："</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">movie_df</span><span class="p">[</span><span class="n">key_len</span><span class="p">].</span><span class="n">describe</span><span class="p">(</span><span class="n">percentiles</span><span class="o">=</span><span class="p">[</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">0.75</span><span class="p">,</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">0.9</span><span class="p">,</span><span class="mf">0.95</span><span class="p">,</span><span class="mf">0.999</span><span class="p">]))</span> <span class="c1"># percentiles指定排前%的取值，默认值是25 45 75
</span><span class="k">print</span><span class="p">(</span><span class="s">"中位数是："</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">movie_df</span><span class="p">[</span><span class="n">key_len</span><span class="p">].</span><span class="n">median</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="s">"数据各个长度分别有多少条："</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">movie_df</span><span class="p">[</span><span class="n">key_len</span><span class="p">].</span><span class="n">value_counts</span><span class="p">())</span> 

<span class="c1"># 查看rating的分布
</span><span class="k">print</span><span class="p">(</span><span class="s">"不同评分分别有多少条："</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">movie_df</span><span class="p">[</span><span class="s">"rating"</span><span class="p">].</span><span class="n">value_counts</span><span class="p">())</span>
</pre></table></code></div></div><p><img data-src="/assets/img/记录：联通2022网络AI技能大赛/2022-09-20-15-22-41.png" alt="" data-proofer-ignore></p><blockquote><p>movie_train.csv 总行数：663226 comment列平均长度：37 comment列最短长度：1 comment列最长长度：200 comment列95%长度小于等于128 comment长度=5的最多：20922条</p></blockquote><blockquote><p>rating列分布： =5 476130条 71.79% =1 187096条 28.21%</p></blockquote><p>测试集 test_set_data.csv 概况</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="s">'''
查看test_set_data.csv文件
'''</span>
<span class="n">movie_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"../test/test_set_data.csv"</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">movie_df</span><span class="p">))</span>

<span class="n">key</span> <span class="o">=</span> <span class="s">"review"</span>
<span class="n">key_len</span> <span class="o">=</span> <span class="n">key</span><span class="o">+</span><span class="s">"_len"</span>
<span class="n">movie_df</span><span class="p">[</span><span class="n">key_len</span><span class="p">]</span><span class="o">=</span><span class="n">movie_df</span><span class="p">[</span><span class="n">key</span><span class="p">].</span><span class="nb">apply</span><span class="p">(</span><span class="nb">str</span><span class="p">).</span><span class="nb">apply</span><span class="p">(</span><span class="nb">len</span><span class="p">)</span>
<span class="c1"># 查看review文本情况
</span><span class="k">print</span><span class="p">(</span><span class="s">"数据长度概览："</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">movie_df</span><span class="p">[</span><span class="n">key_len</span><span class="p">].</span><span class="n">describe</span><span class="p">(</span><span class="n">percentiles</span><span class="o">=</span><span class="p">[</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">0.75</span><span class="p">,</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">0.9</span><span class="p">,</span><span class="mf">0.95</span><span class="p">,</span><span class="mf">0.999</span><span class="p">]))</span> <span class="c1"># percentiles指定排前%的取值，默认值是25 45 75
</span><span class="k">print</span><span class="p">(</span><span class="s">"中位数是："</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">movie_df</span><span class="p">[</span><span class="n">key_len</span><span class="p">].</span><span class="n">median</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="s">"数据各个长度分别有多少条："</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">movie_df</span><span class="p">[</span><span class="n">key_len</span><span class="p">].</span><span class="n">value_counts</span><span class="p">())</span> 
</pre></table></code></div></div><p><img data-src="/assets/img/记录：联通2022网络AI技能大赛/2022-09-20-15-35-32.png" alt="" data-proofer-ignore></p><blockquote><p>test_set_data.csv 总行数：22833 comment列平均长度：45 comment列最短长度：1 comment列最长长度：733 comment列95%长度小于等于143 comment长度=15的最多：599条</p></blockquote><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">scan_all</span><span class="p">():</span>
    <span class="s">'''
    查看raw_data.csv文件
    '''</span>
    <span class="n">movie_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"../code/raw_data.csv"</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">","</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">movie_df</span><span class="p">))</span>

    <span class="n">key</span> <span class="o">=</span> <span class="s">"text"</span>
    <span class="n">key_len</span> <span class="o">=</span> <span class="n">key</span><span class="o">+</span><span class="s">"_len"</span>
    <span class="n">movie_df</span><span class="p">[</span><span class="n">key_len</span><span class="p">]</span><span class="o">=</span><span class="n">movie_df</span><span class="p">[</span><span class="n">key</span><span class="p">].</span><span class="nb">apply</span><span class="p">(</span><span class="nb">len</span><span class="p">)</span>
    <span class="c1"># 查看comment文本情况
</span>    <span class="k">print</span><span class="p">(</span><span class="s">"数据长度概览："</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">movie_df</span><span class="p">[</span><span class="n">key_len</span><span class="p">].</span><span class="n">describe</span><span class="p">(</span><span class="n">percentiles</span><span class="o">=</span><span class="p">[</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">0.75</span><span class="p">,</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">0.9</span><span class="p">,</span><span class="mf">0.95</span><span class="p">,</span><span class="mf">0.999</span><span class="p">]))</span> <span class="c1"># percentiles指定排前%的取值，默认值是25 45 75
</span>    <span class="k">print</span><span class="p">(</span><span class="s">"中位数是："</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">movie_df</span><span class="p">[</span><span class="n">key_len</span><span class="p">].</span><span class="n">median</span><span class="p">())</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"数据各个长度分别有多少条："</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">movie_df</span><span class="p">[</span><span class="n">key_len</span><span class="p">].</span><span class="n">value_counts</span><span class="p">())</span> 

    <span class="c1"># 查看rating的分布
</span>    <span class="k">print</span><span class="p">(</span><span class="s">"不同评分分别有多少条："</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">movie_df</span><span class="p">[</span><span class="s">"label"</span><span class="p">].</span><span class="n">value_counts</span><span class="p">())</span>
</pre></table></code></div></div><blockquote><p>总行数：723034 text列平均长度：38 text列最短长度：1 text列最长长度：2876 text列95%长度小于等于130 text长度=5的最多：21371条</p></blockquote><blockquote><p>label列分布： =disnegative 504703条 69.80% =negative 218331条 30.20%</p></blockquote><p><img data-src="/assets/img/记录：联通2022网络AI技能大赛/2022-09-20-19-10-32.png" alt="" data-proofer-ignore></p><h3 id="2-数据预处理"><span class="mr-2">2. 数据预处理</span><a href="#2-数据预处理" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>将训练数据集合并，把label变成int</p><h3 id="3-数据清理"><span class="mr-2">3. 数据清理</span><a href="#3-数据清理" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>训练和验证数据是队友直接合并的。 测试数据有一行是Nan</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="c1"># 返回test_df中含有空值的行
</span><span class="n">new_df</span> <span class="o">=</span> <span class="n">test_df</span><span class="p">[</span><span class="n">test_df</span><span class="p">.</span><span class="n">isnull</span><span class="p">().</span><span class="nb">any</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span><span class="o">==</span><span class="bp">True</span><span class="p">]</span>
<span class="c1"># 返回test_df中不含有空值的行
</span><span class="n">new_df</span> <span class="o">=</span> <span class="n">test_df</span><span class="p">[</span><span class="n">test_df</span><span class="p">.</span><span class="n">isnull</span><span class="p">().</span><span class="nb">any</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span><span class="o">==</span><span class="bp">False</span><span class="p">]</span>

<span class="c1"># 返回test_df中含有空值的列
</span><span class="n">new_df</span> <span class="o">=</span> <span class="n">test_df</span><span class="p">[</span><span class="n">test_df</span><span class="p">.</span><span class="n">isnull</span><span class="p">().</span><span class="nb">any</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span><span class="o">==</span><span class="bp">True</span><span class="p">]</span>
<span class="c1"># 返回test_df中不含有空值的列
</span><span class="n">new_df</span> <span class="o">=</span> <span class="n">test_df</span><span class="p">[</span><span class="n">test_df</span><span class="p">.</span><span class="n">isnull</span><span class="p">().</span><span class="nb">any</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span><span class="o">==</span><span class="bp">False</span><span class="p">]</span>
</pre></table></code></div></div><p><img data-src="/assets/img/记录：联通2022网络AI技能大赛/2022-09-21-16-21-17.png" alt="" data-proofer-ignore> 删除这一行，并生成新文件替换掉含有空值的旧文件</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">clean_test</span><span class="p">():</span>
    <span class="n">test_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"../test/test_set_data.csv"</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test_df</span><span class="p">))</span>
    <span class="n">new_df</span> <span class="o">=</span> <span class="n">test_df</span><span class="p">[</span><span class="n">test_df</span><span class="p">.</span><span class="n">isnull</span><span class="p">().</span><span class="nb">any</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span><span class="o">==</span><span class="bp">False</span><span class="p">]</span>
    <span class="n">new_df</span><span class="p">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s">"../test/test_set_data1.csv"</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new_df</span>

<span class="n">clean_test</span><span class="p">()</span>
</pre></table></code></div></div><p><img data-src="/assets/img/记录：联通2022网络AI技能大赛/2022-09-21-16-25-16.png" alt="" data-proofer-ignore></p><hr /><ul><li><h2 id="method1bert-base-chinese作为预训练模型"><span class="mr-2">Method1：Bert-Base-Chinese作为预训练模型</span><a href="#method1bert-base-chinese作为预训练模型" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>队友做的93% F1</p><li><h2 id="method2skep作为预训练模型"><span class="mr-2">Method2：SKEP作为预训练模型</span><a href="#method2skep作为预训练模型" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><li> <font color="LightSeaGreen">用Accuracy作为train过程中的evaluate函数的metric，测试的时候再用F1score</font><h3 id="21-batch_size16-acc6385"><span class="mr-2">2.1 batch_size=16 Acc=63.85%</span><a href="#21-batch_size16-acc6385" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>其他超参数： max_seq_length = 128 batch_size = 16 learning_rate = 4e-5 epochs = 3 warmup_proportion = 0.1 weight_decay = 0.01 开始训练：2022-9-20 21:03 结束训练：2022-9-21 15:18 手动停止 进度：</p><blockquote><p>global step 12000, epoch: 1, batch: 12000, loss: 0.78122, accu: 0.66812, speed: 1.55 step/s</p></blockquote></ul><p>一个epoch没训练完，实在太慢了 <img data-src="/assets/img/记录：联通2022网络AI技能大赛/2022-09-21-15-26-12.png" alt="" data-proofer-ignore> <img data-src="/assets/img/记录：联通2022网络AI技能大赛/2022-09-21-15-26-47.png" alt="" data-proofer-ignore></p><p>测试一下test_set_data.csv用当前保存的acc最高的一套模型参数预测,得到预测结果test_set_predict.csv，和test_set_answer.csv对比，计算Acc和F1-score。</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">paddle</span>
<span class="n">paddle</span><span class="p">.</span><span class="n">device</span><span class="p">.</span><span class="n">set_device</span><span class="p">(</span><span class="s">'gpu:1'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">paddle</span><span class="p">.</span><span class="n">device</span><span class="p">.</span><span class="n">get_device</span><span class="p">())</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">from</span> <span class="nn">paddlenlp.datasets</span> <span class="kn">import</span> <span class="n">load_dataset</span>
<span class="kn">from</span> <span class="nn">paddle.io</span> <span class="kn">import</span> <span class="n">Dataset</span><span class="p">,</span> <span class="n">Subset</span>
<span class="kn">from</span> <span class="nn">paddlenlp.datasets</span> <span class="kn">import</span> <span class="n">MapDataset</span>
 
<span class="s">'''
0. loading data...
'''</span>

<span class="n">test</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'../test/test_set_data.csv'</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">read_test</span><span class="p">(</span><span class="n">pd_data</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">pd_data</span><span class="p">.</span><span class="n">iterrows</span><span class="p">():</span>       
        <span class="k">yield</span> <span class="p">{</span><span class="s">'text'</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="s">'review'</span><span class="p">],</span> <span class="s">'label'</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
 
<span class="n">test_ds</span> <span class="o">=</span>  <span class="n">load_dataset</span><span class="p">(</span><span class="n">read_test</span><span class="p">,</span> <span class="n">pd_data</span><span class="o">=</span><span class="n">test</span><span class="p">,</span><span class="n">lazy</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="c1"># 在转换为MapDataset类型
</span><span class="k">def</span> <span class="nf">convert_example</span><span class="p">(</span><span class="n">example</span><span class="p">,</span>
                    <span class="n">tokenizer</span><span class="p">,</span>
                    <span class="n">max_seq_length</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span>
                    <span class="n">is_test</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
   
    <span class="c1"># 将原数据处理成model可读入的格式，enocded_inputs是一个dict，包含input_ids、token_type_ids等字段
</span>    <span class="n">encoded_inputs</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="p">(</span>
        <span class="n">text</span><span class="o">=</span><span class="n">example</span><span class="p">[</span><span class="s">"text"</span><span class="p">],</span> <span class="n">max_seq_len</span><span class="o">=</span><span class="n">max_seq_length</span><span class="p">)</span>
 
    <span class="c1"># input_ids：对文本切分token后，在词汇表中对应的token id
</span>    <span class="n">input_ids</span> <span class="o">=</span> <span class="n">encoded_inputs</span><span class="p">[</span><span class="s">"input_ids"</span><span class="p">]</span>
    <span class="c1"># token_type_ids：当前token属于句子1还是句子2，即上述图中表达的segment ids
</span>    <span class="n">token_type_ids</span> <span class="o">=</span> <span class="n">encoded_inputs</span><span class="p">[</span><span class="s">"token_type_ids"</span><span class="p">]</span>
 
    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_test</span><span class="p">:</span>
        <span class="c1"># label：情感极性类别
</span>        <span class="n">label</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="n">example</span><span class="p">[</span><span class="s">"label"</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="s">"int64"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">input_ids</span><span class="p">,</span> <span class="n">token_type_ids</span><span class="p">,</span> <span class="n">label</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">input_ids</span><span class="p">,</span> <span class="n">token_type_ids</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>
    
<span class="k">def</span> <span class="nf">create_dataloader</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span>
                      <span class="n">trans_fn</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                      <span class="n">mode</span><span class="o">=</span><span class="s">'train'</span><span class="p">,</span>
                      <span class="n">batch_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                      <span class="n">batchify_fn</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    
    <span class="k">if</span> <span class="n">trans_fn</span><span class="p">:</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">.</span><span class="nb">map</span><span class="p">(</span><span class="n">trans_fn</span><span class="p">)</span>
 
    <span class="n">shuffle</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">'train'</span> <span class="k">else</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">"train"</span><span class="p">:</span>
        <span class="n">sampler</span> <span class="o">=</span> <span class="n">paddle</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">DistributedBatchSampler</span><span class="p">(</span>
            <span class="n">dataset</span><span class="o">=</span><span class="n">dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="n">shuffle</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sampler</span> <span class="o">=</span> <span class="n">paddle</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">BatchSampler</span><span class="p">(</span>
            <span class="n">dataset</span><span class="o">=</span><span class="n">dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="n">shuffle</span><span class="p">)</span>
    <span class="n">dataloader</span> <span class="o">=</span> <span class="n">paddle</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">DataLoader</span><span class="p">(</span>
        <span class="n">dataset</span><span class="p">,</span> <span class="n">batch_sampler</span><span class="o">=</span><span class="n">sampler</span><span class="p">,</span> <span class="n">collate_fn</span><span class="o">=</span><span class="n">batchify_fn</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dataloader</span>
<span class="s">'''
1. loading model...
'''</span>
<span class="kn">from</span> <span class="nn">paddlenlp.transformers</span> <span class="kn">import</span> <span class="n">SkepForSequenceClassification</span><span class="p">,</span> <span class="n">SkepTokenizer</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">SkepForSequenceClassification</span><span class="p">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">pretrained_model_name_or_path</span><span class="o">=</span><span class="s">"skep_ernie_2.0_large_en"</span><span class="p">,</span> <span class="n">num_classes</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">SkepTokenizer</span><span class="p">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">pretrained_model_name_or_path</span><span class="o">=</span><span class="s">"skep_ernie_2.0_large_en"</span><span class="p">)</span>

<span class="s">'''
2. define superparameters...
'''</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">paddle.nn.functional</span> <span class="k">as</span> <span class="n">F</span>
<span class="kn">from</span> <span class="nn">paddlenlp.data</span> <span class="kn">import</span> <span class="n">Stack</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Pad</span>
<span class="n">batch_size</span><span class="o">=</span><span class="mi">16</span>
<span class="n">max_seq_length</span><span class="o">=</span><span class="mi">128</span>
<span class="c1"># 处理测试集数据
</span><span class="n">trans_func</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span>
    <span class="n">convert_example</span><span class="p">,</span>
    <span class="n">tokenizer</span><span class="o">=</span><span class="n">tokenizer</span><span class="p">,</span>
    <span class="n">max_seq_length</span><span class="o">=</span><span class="n">max_seq_length</span><span class="p">,</span>
    <span class="n">is_test</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">batchify_fn</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">samples</span><span class="p">,</span> <span class="n">fn</span><span class="o">=</span><span class="n">Tuple</span><span class="p">(</span>
    <span class="n">Pad</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">pad_val</span><span class="o">=</span><span class="n">tokenizer</span><span class="p">.</span><span class="n">pad_token_id</span><span class="p">),</span>  <span class="c1"># input
</span>    <span class="n">Pad</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">pad_val</span><span class="o">=</span><span class="n">tokenizer</span><span class="p">.</span><span class="n">pad_token_type_id</span><span class="p">),</span>  <span class="c1"># segment
</span>    <span class="n">Stack</span><span class="p">()</span> <span class="c1"># qid
</span><span class="p">):</span> <span class="p">[</span><span class="n">data</span> <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">fn</span><span class="p">(</span><span class="n">samples</span><span class="p">)]</span>
<span class="n">test_data_loader</span> <span class="o">=</span> <span class="n">create_dataloader</span><span class="p">(</span>
    <span class="n">test_ds</span><span class="p">,</span>
    <span class="n">mode</span><span class="o">=</span><span class="s">'test'</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
    <span class="n">batchify_fn</span><span class="o">=</span><span class="n">batchify_fn</span><span class="p">,</span>
    <span class="n">trans_fn</span><span class="o">=</span><span class="n">trans_func</span><span class="p">)</span>

<span class="s">'''
3. evalue the model...
'''</span>

<span class="kn">import</span> <span class="nn">os</span>
 
<span class="c1"># 根据实际运行情况，更换加载的参数路径
</span><span class="n">params_path</span> <span class="o">=</span> <span class="s">'best_checkpoint/best_model.pdparams'</span>
<span class="k">if</span> <span class="n">params_path</span> <span class="ow">and</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">params_path</span><span class="p">):</span>
    <span class="c1"># 加载模型参数
</span>    <span class="n">state_dict</span> <span class="o">=</span> <span class="n">paddle</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">params_path</span><span class="p">)</span>
    <span class="n">model</span><span class="p">.</span><span class="n">set_dict</span><span class="p">(</span><span class="n">state_dict</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Loaded parameters from %s"</span> <span class="o">%</span> <span class="n">params_path</span><span class="p">)</span>
    
<span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c1"># 切换model模型为评估模式，关闭dropout等随机因素
</span><span class="n">model</span><span class="p">.</span><span class="nb">eval</span><span class="p">()</span>
<span class="k">for</span> <span class="n">batch</span> <span class="ow">in</span> <span class="n">test_data_loader</span><span class="p">:</span>
    <span class="n">input_ids</span><span class="p">,</span> <span class="n">token_type_ids</span><span class="p">,</span> <span class="n">qids</span> <span class="o">=</span> <span class="n">batch</span>
    <span class="c1"># 喂数据给模型
</span>    <span class="n">logits</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">input_ids</span><span class="p">,</span> <span class="n">token_type_ids</span><span class="p">)</span>
    <span class="c1"># 预测分类
</span>    <span class="n">probs</span> <span class="o">=</span> <span class="n">F</span><span class="p">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">logits</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">paddle</span><span class="p">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">probs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">).</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span><span class="p">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">qids</span> <span class="o">=</span> <span class="n">qids</span><span class="p">.</span><span class="n">numpy</span><span class="p">().</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">results</span><span class="p">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">qids</span><span class="p">,</span> <span class="n">idx</span><span class="p">))</span>

<span class="s">'''
4. save predict result...
'''</span>    
<span class="c1"># 写入预测结果，提交
</span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span> <span class="s">"submission.csv"</span><span class="p">,</span> <span class="s">'w'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">"utf-8"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="c1"># f.write("数据ID,评分\n")
</span>    <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="s">"label</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
 
    <span class="k">for</span> <span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
        <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">label</span><span class="p">)</span><span class="o">+</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
</pre></table></code></div></div><p><img data-src="/assets/img/记录：联通2022网络AI技能大赛/2022-09-21-15-30-44.png" alt="" data-proofer-ignore></p><h5 id="conclusion"><span class="mr-2"><strong><center><font color="Navy"><span class="mr-2">Conclusion</font></center></strong></span><a href="#conclusion" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>分析：结果不好，准确率只有63.85%
</pre></table></code></div></div><h5 id="question"><span class="mr-2"><strong><center><font color="Tomato"><span class="mr-2">Question</font></center></strong></span><a href="#question" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><p>问题1：loss曲线出现了震荡情况，且不收敛</p><p>解决方案：根据知乎的解释 a. batchsize太小，过拟合了当前batch，以至于batch上预估的梯度无法有效近似数据集分布上估计的梯度，从而无法泛化到下一个batch上。解决方案: 调大batchsize, 使用带动量的梯度。</p><font color="DodgerBlue">batchsize=16，的确有些小，但是已经是带动量的梯度了</font><p><del>b. 学习率太大。解决方案：减小学习率。</del></p><font color="DodgerBlue">学习率已经是4e-5</font><p><del>c. 收敛区域不太好但又跳不出来，想想进入了凹凸不平的盆地。解决方案：周期学习率。</del></p><font color="DodgerBlue">学习率已经是周期学习率</font><h3 id="22-batch_size64-acc7146存档1"><span class="mr-2">2.2 batch_size=64 Acc=71.46%(存档1)</span><a href="#22-batch_size64-acc7146存档1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>其他超参数： max_seq_length = 128 batch_size = 64 learning_rate = 4e-5 epochs = 3 warmup_proportion = 0.1 weight_decay = 0.01 开始训练：2022-09-21 15:56:28</p><h4 id="221-存档1"><span class="mr-2">2.2.1 存档1</span><a href="#221-存档1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>当前时间：2022-09-22 09:46:30 进度：</p><blockquote><p>模型保存在 16500 步， 最佳eval准确度为0.81037571！ global step 16190, epoch: 2, batch: 7152, loss: 0.32919, accu: 0.82326, speed: 1.34 step/s</p></blockquote><p><img data-src="/assets/img/记录：联通2022网络AI技能大赛/2022-09-22-09-48-29.png" alt="" data-proofer-ignore></p><p>速度快多了。并且acc收敛了，&lt;font color=&gt;为啥loss还在震荡？！！！&lt;/font&gt;。 <img data-src="/assets/img/记录：联通2022网络AI技能大赛/2022-09-22-09-54-55.png" alt="" data-proofer-ignore><br /> <img data-src="/assets/img/记录：联通2022网络AI技能大赛/2022-09-22-09-55-18.png" alt="" data-proofer-ignore></p><p>查阅资料[^trainloss震荡]得到以下分析：</p><blockquote><p>1.train_loss 不断下降，val_loss(test_lost) 不断下降</p><p>说明网络训练正常，最好情况</p><p>2.train_loss 不断下降，val_loss(test_lost) 趋于不变</p><p>说明网络过拟合，可以添加dropout和最大池化max pooling</p><p>3.train_loss 趋于不变，val_loss(test_lost) 不断下降</p><p>说明数据集有问题，建议重新选择</p><p>4.train_loss 趋于不变，val_loss(test_lost) 趋于不变</p><p>说明学习遇到瓶颈，需要减小学习率或批量batch数目</p><p>5.train_loss 不断上升，val_loss(test_lost) 不断上升</p><p>说明网络结构设计不当，训练超参数设置不当，数据集经过清洗等问题，最差情况</p></blockquote><p>审阅这轮参数的模型给出的预测结果：</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="n">answer</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"../test/test_set_answer.csv"</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
<span class="n">predict</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"../test/test_set_predict.csv"</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">analysis</span><span class="p">(</span><span class="n">predict</span><span class="p">,</span><span class="n">answer</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">predict</span><span class="p">)</span><span class="o">!=</span><span class="nb">len</span><span class="p">(</span><span class="n">answer</span><span class="p">):</span>
        <span class="k">return</span> 
    <span class="n">distribution_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s">'11'</span><span class="p">:[],</span><span class="s">'01'</span><span class="p">:[],</span><span class="s">'10'</span><span class="p">:[],</span><span class="s">'00'</span><span class="p">:[]}</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,(</span><span class="n">pred</span><span class="p">,</span><span class="n">ans</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">predict</span><span class="p">,</span><span class="n">answer</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">idx</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">continue</span> <span class="c1">#跳过首行
</span>        <span class="n">distribution_dict</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">ans</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">pred</span><span class="p">)].</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        
    <span class="c1"># 将distribution_dict的所有list填充到一致的长度，用0填充
</span>    <span class="n">pad_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s">'11'</span><span class="p">:[],</span><span class="s">'01'</span><span class="p">:[],</span><span class="s">'10'</span><span class="p">:[],</span><span class="s">'00'</span><span class="p">:[]}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value_list</span> <span class="ow">in</span> <span class="n">distribution_dict</span><span class="p">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">value_list</span><span class="p">)</span>
        <span class="n">arr_pad</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">pad</span><span class="p">(</span><span class="n">array</span><span class="o">=</span><span class="n">arr</span><span class="p">,</span>
                <span class="n">pad_width</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">l</span> <span class="ow">in</span> <span class="n">distribution_dict</span><span class="p">.</span><span class="n">items</span><span class="p">()])</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">value_list</span><span class="p">)),</span><span class="c1"># 开头填充0个元素，结尾填充（四个list最长长度-当前list的长度）个元素
</span>                <span class="n">mode</span><span class="o">=</span><span class="s">'constant'</span><span class="p">)</span>
        <span class="n">pad_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">arr_pad</span><span class="p">.</span><span class="n">tolist</span><span class="p">()</span>
    
    <span class="n">ana_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">pad_dict</span><span class="p">)</span>
    <span class="n">ana_df</span><span class="p">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s">"./bs64/analy_distribution.csv"</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">"</span><span class="se">\t</span><span class="s">"</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>    
    <span class="k">return</span> <span class="n">ana_df</span>

<span class="k">def</span> <span class="nf">distribution_rate</span><span class="p">(</span><span class="n">ana_df</span><span class="p">):</span>
    <span class="n">count11</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ana_df</span><span class="p">[</span><span class="s">'11'</span><span class="p">])</span>
    <span class="n">count10</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ana_df</span><span class="p">[</span><span class="o">~</span><span class="n">ana_df</span><span class="p">[</span><span class="s">'10'</span><span class="p">].</span><span class="n">isin</span><span class="p">([</span><span class="mi">0</span><span class="p">])])</span>
    <span class="n">count01</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ana_df</span><span class="p">[</span><span class="o">~</span><span class="n">ana_df</span><span class="p">[</span><span class="s">'01'</span><span class="p">].</span><span class="n">isin</span><span class="p">([</span><span class="mi">0</span><span class="p">])])</span>
    <span class="n">count00</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ana_df</span><span class="p">[</span><span class="o">~</span><span class="n">ana_df</span><span class="p">[</span><span class="s">'00'</span><span class="p">].</span><span class="n">isin</span><span class="p">([</span><span class="mi">0</span><span class="p">])])</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"答案是1，预测是1："</span><span class="p">,</span><span class="n">count11</span><span class="p">)</span> <span class="c1"># 11列没有0
</span>    <span class="k">print</span><span class="p">(</span><span class="s">"答案是1，预测是0："</span><span class="p">,</span><span class="n">count10</span><span class="p">)</span> 
    <span class="k">print</span><span class="p">(</span><span class="s">"答案是0，预测是1："</span><span class="p">,</span><span class="n">count01</span><span class="p">)</span> 
    <span class="k">print</span><span class="p">(</span><span class="s">"答案是0，预测是0："</span><span class="p">,</span><span class="n">count00</span><span class="p">,</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span> 
    
    <span class="k">print</span><span class="p">(</span><span class="s">"预测是1中，预测对的有："</span><span class="p">,</span><span class="n">count11</span><span class="o">/</span><span class="p">(</span><span class="n">count11</span><span class="o">+</span><span class="n">count01</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"预测是0中，预测对的有："</span><span class="p">,</span><span class="n">count00</span><span class="o">/</span><span class="p">(</span><span class="n">count10</span><span class="o">+</span><span class="n">count00</span><span class="p">),</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
    
    <span class="k">print</span><span class="p">(</span><span class="s">"答案是1中，预测对的有："</span><span class="p">,</span><span class="n">count11</span><span class="o">/</span><span class="p">(</span><span class="n">count11</span><span class="o">+</span><span class="n">count10</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"答案是0中，预测对的有："</span><span class="p">,</span><span class="n">count00</span><span class="o">/</span><span class="p">(</span><span class="n">count01</span><span class="o">+</span><span class="n">count00</span><span class="p">),</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
    
    <span class="k">print</span><span class="p">(</span><span class="s">"所有预测错的中，（答案=）1的有："</span><span class="p">,</span><span class="n">count10</span><span class="o">/</span><span class="p">(</span><span class="n">count10</span><span class="o">+</span><span class="n">count01</span><span class="p">),</span><span class="s">"所有预测错的中，（答案=）0的有："</span><span class="p">,</span><span class="n">count01</span><span class="o">/</span><span class="p">(</span><span class="n">count10</span><span class="o">+</span><span class="n">count01</span><span class="p">))</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">analysis</span><span class="p">(</span><span class="n">predict</span><span class="p">[</span><span class="s">'label'</span><span class="p">],</span><span class="n">answer</span><span class="p">[</span><span class="s">'label'</span><span class="p">])</span>   
<span class="n">distribution_rate</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></table></code></div></div><p><img data-src="/assets/img/记录：联通2022网络AI技能大赛/2022-09-22-10-37-46.png" alt="" data-proofer-ignore> 很明显，样本不均衡导致预测结果中，积极情感预测效果好，而消极情感预测效果差。</p><h4 id="222-存档2"><span class="mr-2">2.2.2 存档2</span><a href="#222-存档2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>当前时间：2022-09-22 11:12:30 进度：</p><blockquote><p>上一个存档： 模型保存在 16500 步， 最佳eval准确度为0.81037571！ global step 16190, epoch: 2, batch: 7152, loss: 0.32919, accu: 0.82326, speed: 1.34 step/s 当前存档： 模型保存在 17800 步， 最佳eval准确度为0.81231891！ global step 17860, epoch: 2, batch: 8822, loss: 0.37988, accu: 0.81094, speed: 1.33 step/s</p></blockquote><p><img data-src="/assets/img/记录：联通2022网络AI技能大赛/2022-09-22-11-14-51.png" alt="" data-proofer-ignore> <img data-src="/assets/img/记录：联通2022网络AI技能大赛/2022-09-22-11-15-17.png" alt="" data-proofer-ignore></p><h4 id="question-1"><span class="mr-2"><strong><center><font color="Tomato"><span class="mr-2">Question</font></center></strong></span><a href="#question-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>问题1：loss曲线出现了震荡情况 解决方案：根据csdn的解释，应当是数据集的问题，样本不均衡。根据知乎的解释，极不平衡要做的，除非小样本数据里有特别特别明显的特征，要不然会训练不出来。 （1）对数据少的类别，要做数据增强。可以去查查，目前有很多数据增强的方法，例如同义词替换、生成、改写。 （2）loss的设大，可以增加少样本类别的loss权重，让模型重视这一类别，而不是一视同仁</p><h3 id="23-batch_size64-loss_weight23110"><span class="mr-2">2.3 batch_size=64 loss_weight=[2.31,1.0]</span><a href="#23-batch_size64-loss_weight23110" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>其他超参数(与1.2保持一致)： max_seq_length = 128 batch_size = 64 learning_rate = 4e-5 epochs = 3 warmup_proportion = 0.1 weight_decay = 0.01 开始训练：2022-09-22 14:12:28</p><h4 id="231-存档1"><span class="mr-2">2.3.1 存档1</span><a href="#231-存档1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>当前时间：2022-09-22 19:01:30 在paddle_finetune.py文件中，165行设置如下：</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="c1"># 由于样本不平衡，指定交叉熵损失函数每个类别的权重M2
# M1.[1/count(0),1/count(1)]
# M2.[max(count)/count(0),max(count)/count(1)]
</span><span class="n">weight_data</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2.31</span><span class="p">,</span><span class="mf">1.0</span><span class="p">]).</span><span class="n">astype</span><span class="p">(</span><span class="s">"float32"</span><span class="p">)</span>
<span class="n">weight</span> <span class="o">=</span> <span class="n">paddle</span><span class="p">.</span><span class="n">to_tensor</span><span class="p">(</span><span class="n">weight_data</span><span class="p">)</span>
</pre></table></code></div></div><blockquote><p>当前存档： 模型保存在 900 步， 最佳eval准确度为0.72405209！ global step 3460, epoch: 1, batch: 3460, loss: 0.69813, accu: 0.49036, speed: 0.60 step/s</p></blockquote><p><img data-src="/assets/img/2022-09-22-记录：联通2022网络AI技能大赛/2022-09-22-18-59-18.png" alt="" data-proofer-ignore> <img data-src="/assets/img/2022-09-22-记录：联通2022网络AI技能大赛/2022-09-22-18-59-38.png" alt="" data-proofer-ignore></p><p>是不是weight设反了？</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="n">由于样本不平衡</span><span class="err">，</span><span class="n">指定交叉熵损失函数每个类别的权重M2</span>
<span class="n">M1</span><span class="p">.[</span><span class="mi">1</span><span class="o">/</span><span class="n">count</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="mi">1</span><span class="o">/</span><span class="n">count</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span>
<span class="n">M2</span><span class="p">.[</span><span class="nb">max</span><span class="p">(</span><span class="n">count</span><span class="p">)</span><span class="o">/</span><span class="n">count</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">count</span><span class="p">)</span><span class="o">/</span><span class="n">count</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span>
<span class="n">weight_data</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">2.31</span><span class="p">]).</span><span class="n">astype</span><span class="p">(</span><span class="s">"float32"</span><span class="p">)</span>
<span class="n">weight</span> <span class="o">=</span> <span class="n">paddle</span><span class="p">.</span><span class="n">to_tensor</span><span class="p">(</span><span class="n">weight_data</span><span class="p">)</span>

<span class="n">criterion</span> <span class="o">=</span> <span class="n">paddle</span><span class="p">.</span><span class="n">nn</span><span class="p">.</span><span class="n">loss</span><span class="p">.</span><span class="n">CrossEntropyLoss</span><span class="p">(</span><span class="n">weight</span><span class="o">=</span><span class="n">weight</span><span class="p">)</span>  <span class="c1"># 交叉熵损失函数
</span></pre></table></code></div></div><blockquote><p>模型保存在 3500 步， 最佳eval准确度为0.78014204！ global step 11240, epoch: 2, batch: 2202, loss: 0.37571, accu: 0.70195, speed: 1.11 step/s</p></blockquote><p><img data-src="/assets/img/2022-09-22-记录：联通2022网络AI技能大赛/2022-09-23-10-55-39.png" alt="" data-proofer-ignore> <img data-src="/assets/img/2022-09-22-记录：联通2022网络AI技能大赛/2022-09-23-10-55-58.png" alt="" data-proofer-ignore></p><p>为什么还是不行？？</p><blockquote><p>5.train_loss 不断上升，val_loss(test_lost) 不断上升 说明网络结构设计不当，训练超参数设置不当，数据集经过清洗等问题，最差情况</p></blockquote><p>难道是超参数？</p><h3 id="23-数据增强-增加负样本数据微调"><span class="mr-2">2.3 数据增强-增加负样本数据微调</span><a href="#23-数据增强-增加负样本数据微调" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
</pre><td class="rouge-code"><pre><span class="s">'''
生成负样本1：1
'''</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">jieba</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="kn">from</span> <span class="nn">gensim.models</span> <span class="kn">import</span> <span class="n">KeyedVectors</span><span class="p">,</span> <span class="n">TfidfModel</span>
<span class="kn">from</span> <span class="nn">gensim.corpora</span> <span class="kn">import</span> <span class="n">Dictionary</span>
<span class="kn">from</span> <span class="nn">utils.utils</span> <span class="kn">import</span> <span class="n">read_samples</span><span class="p">,</span> <span class="n">write_samples</span><span class="p">,</span> <span class="n">isChinese</span>
<span class="kn">from</span> <span class="nn">gensim</span> <span class="kn">import</span> <span class="n">matutils</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">islice</span>

<span class="k">class</span> <span class="nc">EmbedReplace</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sample_path</span><span class="p">,</span> <span class="n">wv_path</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">samples</span> <span class="o">=</span> <span class="n">read_samples</span><span class="p">(</span><span class="n">sample_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">samples</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">jieba</span><span class="p">.</span><span class="n">cut</span><span class="p">(</span><span class="n">sample</span><span class="p">))</span> <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">samples</span><span class="p">]</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">wv</span> <span class="o">=</span> <span class="n">KeyedVectors</span><span class="p">.</span><span class="n">load_word2vec_format</span><span class="p">(</span><span class="n">wv_path</span><span class="p">,</span> <span class="n">binary</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="s">'tfidf_word2vec/tfidf.model'</span><span class="p">):</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">tfidf_model</span> <span class="o">=</span> <span class="n">TfidfModel</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="s">'tfidf_word2vec/tfidf.model'</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">dct</span> <span class="o">=</span> <span class="n">Dictionary</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="s">'tfidf_word2vec/tfidf.dict'</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">corpus</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="p">.</span><span class="n">dct</span><span class="p">.</span><span class="n">doc2bow</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">samples</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">dct</span> <span class="o">=</span> <span class="n">Dictionary</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">samples</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">corpus</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="p">.</span><span class="n">dct</span><span class="p">.</span><span class="n">doc2bow</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">samples</span><span class="p">]</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">tfidf_model</span> <span class="o">=</span> <span class="n">TfidfModel</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">corpus</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">dct</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="s">'tfidf_word2vec/tfidf.dict'</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">tfidf_model</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="s">'tfidf_word2vec/tfidf.model'</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">vocab_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">dct</span><span class="p">.</span><span class="n">token2id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">vectorize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">,</span> <span class="n">vocab_size</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">matutils</span><span class="p">.</span><span class="n">corpus2dense</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">vocab_size</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">extract_keywords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dct</span><span class="p">,</span> <span class="n">tfidf</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">topk</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
        <span class="s">""" 提取关键词

        :param dct (Dictionary): gensim.corpora.Dictionary
        :param tfidf (list):
        :param threshold: tfidf的临界值
        :param topk: 前 topk 个关键词
        :return: 返回的关键词列表
        """</span>
        <span class="n">tfidf</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">tfidf</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">islice</span><span class="p">([</span><span class="n">dct</span><span class="p">[</span><span class="n">w</span><span class="p">]</span> <span class="k">for</span> <span class="n">w</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="n">tfidf</span> <span class="k">if</span> <span class="n">score</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">],</span> <span class="n">topk</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sample</span><span class="p">,</span> <span class="n">doc</span><span class="p">):</span>
        <span class="s">"""用wordvector的近义词来替换，并避开关键词

        :param sample (list): reference token list
        :param doc (list): A reference represented by a word bag model
        :return: 新的文本
        """</span>
        <span class="n">keywords</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">extract_keywords</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">dct</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">tfidf_model</span><span class="p">[</span><span class="n">doc</span><span class="p">])</span>
        <span class="c1">#
</span>        <span class="n">num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.3</span><span class="p">)</span>
        <span class="n">new_tokens</span> <span class="o">=</span> <span class="n">sample</span><span class="p">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">indexes</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sample</span><span class="p">),</span> <span class="n">num</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">indexes</span><span class="p">:</span>
            <span class="n">token</span> <span class="o">=</span> <span class="n">sample</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">isChinese</span><span class="p">(</span><span class="n">token</span><span class="p">)</span> <span class="ow">and</span> <span class="n">token</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keywords</span> <span class="ow">and</span> <span class="n">token</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">wv</span><span class="p">:</span>
                <span class="n">new_tokens</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">wv</span><span class="p">.</span><span class="n">most_similar</span><span class="p">(</span><span class="n">positive</span><span class="o">=</span><span class="n">token</span><span class="p">,</span> <span class="n">negative</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">topn</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">return</span> <span class="s">''</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">new_tokens</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">generate_samples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">write_path</span><span class="p">):</span>
        <span class="s">"""得到用word2vector词表增强后的数据

        :param write_path:
        """</span>
        <span class="n">replaced</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">sample</span><span class="p">,</span> <span class="n">doc</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">samples</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">corpus</span><span class="p">):</span>
            <span class="n">replaced</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span> <span class="n">doc</span><span class="p">))</span>
        <span class="n">write_samples</span><span class="p">(</span><span class="n">replaced</span><span class="p">,</span> <span class="n">write_path</span><span class="p">,</span> <span class="s">'a'</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">sample_path</span> <span class="o">=</span> <span class="s">'data/train.txt'</span>
    <span class="n">wv_path</span> <span class="o">=</span> <span class="s">'tfidf_word2vec/sgns.weibo.bigram-char'</span>
    <span class="n">replacer</span> <span class="o">=</span> <span class="n">EmbedReplace</span><span class="p">(</span><span class="n">sample_path</span><span class="p">,</span> <span class="n">wv_path</span><span class="p">)</span>
    <span class="n">replacer</span><span class="p">.</span><span class="n">generate_samples</span><span class="p">(</span><span class="s">'data/replaced.txt'</span><span class="p">)</span>

</pre></table></code></div></div><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="s">'''
合并数据增强的结果到原训练数据中
'''</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>

<span class="n">text</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"./NLP-Data-Augmentation-main/data/replaced.txt"</span><span class="p">,</span><span class="s">'r'</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="s">"utf-8"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">readlines</span><span class="p">()</span>
<span class="n">text</span><span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">text</span><span class="p">]</span> <span class="c1"># 删除换行符
</span><span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s">"text"</span><span class="p">:</span><span class="n">text</span><span class="p">}</span>
<span class="n">nega_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="n">nega_df</span><span class="p">[</span><span class="s">"label"</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">old_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"raw_data.csv"</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">"</span><span class="se">\t</span><span class="s">"</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>

<span class="n">merge_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">concat</span><span class="p">([</span><span class="n">old_df</span><span class="p">,</span><span class="n">nega_df</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">).</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">merge_df</span><span class="p">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s">"enhanced_data.csv"</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">"</span><span class="se">\t</span><span class="s">"</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

</pre></table></code></div></div><p><img data-src="/assets/img/2022-09-22-记录：联通2022网络AI技能大赛/2022-09-23-11-05-39.png" alt="" data-proofer-ignore> 增强后的正负样本比例接近1：1，不再需要调整交叉熵类别权重，weight删除。</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">criterion</span> <span class="o">=</span> <span class="n">paddle</span><span class="p">.</span><span class="n">nn</span><span class="p">.</span><span class="n">loss</span><span class="p">.</span><span class="n">CrossEntropyLoss</span><span class="p">()</span>  <span class="c1"># 交叉熵损失函数
</span></pre></table></code></div></div><p>因为上面的实验超参数貌似不合适，全部根据官方文档<sup id="fnref:SKEP" role="doc-noteref"><a href="#fn:SKEP" class="footnote" rel="footnote">1</a></sup>修改：</p><p><img data-src="/assets/img/2022-09-22-记录：联通2022网络AI技能大赛/2022-09-23-11-08-47.png" alt="" data-proofer-ignore></p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="s">'''
0. define super-parameters
'''</span>
<span class="n">max_seq_length</span> <span class="o">=</span> <span class="mi">128</span>
<span class="n">batch_size</span> <span class="o">=</span> <span class="mi">64</span>
<span class="n">learning_rate</span> <span class="o">=</span> <span class="mf">5e-5</span>
<span class="n">epochs</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">warmup_proportion</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">weight_decay</span> <span class="o">=</span> <span class="mf">0.00</span>
</pre></table></code></div></div><ul><li><h2 id="method3skep-large作为预训练模型"><span class="mr-2">Method3：SKEP-large作为预训练模型</span><a href="#method3skep-large作为预训练模型" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="31-调用api"><span class="mr-2">3.1 调用API</span><a href="#31-调用api" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></ul><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">paddlenlp</span> <span class="kn">import</span> <span class="n">Taskflow</span> 
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>

<span class="n">all_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"../test/test_set_data.csv"</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">"</span><span class="se">\t</span><span class="s">"</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
<span class="n">senta</span> <span class="o">=</span> <span class="n">Taskflow</span><span class="p">(</span><span class="s">"sentiment_analysis"</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s">"skep_ernie_1.0_large_ch"</span><span class="p">,</span> <span class="n">device_id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> 

<span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s">"negative"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s">"positive"</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>

<span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">all_df</span><span class="p">[</span><span class="s">"review"</span><span class="p">]:</span>
    <span class="c1"># print(senta(text)[0])
</span>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"try/test_set_predict.csv"</span><span class="p">,</span><span class="s">"a"</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="s">"utf-8"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">senta</span><span class="p">(</span><span class="n">text</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="s">'label'</span><span class="p">]])</span><span class="o">+</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>

</pre></table></code></div></div><p><img data-src="/assets/img/2022-09-22-记录：联通2022网络AI技能大赛/2022-09-22-19-11-55.png" alt="" data-proofer-ignore></p><h3 id="32-数据增强-增加负样本数据微调"><span class="mr-2">3.2 数据增强-增加负样本数据微调</span><a href="#32-数据增强-增加负样本数据微调" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>其他超参数： max_seq_length = 128 batch_size = 64 learning_rate = 5e-5 epochs = 3</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>    warmup_proportion = 0.0
    weight_decay = 0.00 开始训练：2022-9-23 17:47 结束训练： 进度：
</pre></table></code></div></div><font color="red">不知道为什么，数据量一多nohup就不训练。只能vscode中训练，但是一直挂机不显示。大概是1w的数据量可以训练。9w不行。</font><h3 id="33-根据概率值增加if-else逼近答案"><span class="mr-2">3.3 根据概率值增加If-Else，逼近答案</span><a href="#33-根据概率值增加if-else逼近答案" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h2 id="linkreference"><span class="mr-2">:link:Reference</span><a href="#linkreference" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="footnotes" role="doc-endnotes"><ol><li id="fn:SKEP" role="doc-endnote"><p>https://github.com/PaddlePaddle/PaddleNLP/tree/develop/examples/sentiment_analysis/skep <a href="#fnref:SKEP" class="reversefootnote" role="doc-backlink">&#8617;</a></p></ol></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/nlp/'>NLP</a>, <a href='/categories/%E6%AF%94%E8%B5%9B%E8%AE%B0%E5%BD%95/'>比赛记录</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/nlp/" class="post-tag no-text-decoration" >nlp</a> <a href="/tags/%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB/" class="post-tag no-text-decoration" >文本分类</a> <a href="/tags/%E6%83%85%E6%84%9F%E5%88%86%E7%B1%BB/" class="post-tag no-text-decoration" >情感分类</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> 本文由作者按照 <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> 进行授权</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">分享</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=%E8%AE%B0%E5%BD%95%EF%BC%9A%E8%81%94%E9%80%9A2022%E7%BD%91%E7%BB%9CAI%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B+-+zoe+Chen&url=https%3A%2F%2Fzoechen119.github.io%2Fposts%2F%25E8%25AE%25B0%25E5%25BD%2595-%25E8%2581%2594%25E9%2580%259A2022%25E7%25BD%2591%25E7%25BB%259CAI%25E6%258A%2580%25E8%2583%25BD%25E5%25A4%25A7%25E8%25B5%259B%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=%E8%AE%B0%E5%BD%95%EF%BC%9A%E8%81%94%E9%80%9A2022%E7%BD%91%E7%BB%9CAI%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B+-+zoe+Chen&u=https%3A%2F%2Fzoechen119.github.io%2Fposts%2F%25E8%25AE%25B0%25E5%25BD%2595-%25E8%2581%2594%25E9%2580%259A2022%25E7%25BD%2591%25E7%25BB%259CAI%25E6%258A%2580%25E8%2583%25BD%25E5%25A4%25A7%25E8%25B5%259B%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fzoechen119.github.io%2Fposts%2F%25E8%25AE%25B0%25E5%25BD%2595-%25E8%2581%2594%25E9%2580%259A2022%25E7%25BD%2591%25E7%25BB%259CAI%25E6%258A%2580%25E8%2583%25BD%25E5%25A4%25A7%25E8%25B5%259B%2F&text=%E8%AE%B0%E5%BD%95%EF%BC%9A%E8%81%94%E9%80%9A2022%E7%BD%91%E7%BB%9CAI%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B+-+zoe+Chen" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="分享链接" data-title-succeed="链接已复制！"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">最近更新</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/C25_11%E5%85%A5%E9%97%A8%E8%87%AA%E7%84%B6%E8%AF%AD%E8%A8%80%E5%A4%84%E7%90%860/">【NLP入门趣味题】肉眼找朋友</a><li><a href="/posts/C25_11%E5%85%A5%E9%97%A8%E8%87%AA%E7%84%B6%E8%AF%AD%E8%A8%80%E5%A4%84%E7%90%861/">【NLP入门趣味题】探索语言模型与词向量</a><li><a href="/posts/%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0/">强化学习</a><li><a href="/posts/%E5%A4%9A%E6%A8%A1%E6%80%81%E5%AE%9E%E9%AA%8C/">多模态实验</a><li><a href="/posts/%E5%A4%9A%E6%A8%A1%E6%80%81RAG/">多模态rag</a></ul></div><div id="access-tags"><div class="panel-heading">热门标签</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/nlp/">nlp</a> <a class="post-tag" href="/tags/%E6%8A%80%E6%9C%AF%E7%BB%BC%E8%BF%B0/">技术综述</a> <a class="post-tag" href="/tags/%E8%AE%BA%E6%96%87%E7%AC%94%E8%AE%B0/">论文笔记</a> <a class="post-tag" href="/tags/rag/">RAG</a> <a class="post-tag" href="/tags/%E8%AF%AD%E8%A8%80%E5%AD%A6/">语言学</a> <a class="post-tag" href="/tags/%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B/">预训练模型</a> <a class="post-tag" href="/tags/bert/">BERT</a> <a class="post-tag" href="/tags/courses/">Courses</a> <a class="post-tag" href="/tags/chatgpt/">ChatGPT</a> <a class="post-tag" href="/tags/mamba/">Mamba</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">文章内容</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>相关文章</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/C25_11%E5%85%A5%E9%97%A8%E8%87%AA%E7%84%B6%E8%AF%AD%E8%A8%80%E5%A4%84%E7%90%860/"><div class="card-body"> <em class="small" data-ts="1745910056" data-df="YYYY-MM-DD" > 2025-04-29 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>【NLP入门趣味题】肉眼找朋友</h3><div class="text-muted small"><p> 【NLP入门趣味题】肉眼找朋友 ❓ 问题1：肉眼找朋友 观察坐标，回答以下问题（无需计算）： “国王” 和 “王后” 的距离近，还是 “苹果” 和 “香蕉” 的距离近？ 如果 “国王” 的坐标是 (1, 0)，你觉得 “王子” 的坐标可能是？ A. (0.8, 0.2) B. (0, 0.8) 💡 提示：第一个数字代表...</p></div></div></a></div><div class="card"> <a href="/posts/C25_11%E5%85%A5%E9%97%A8%E8%87%AA%E7%84%B6%E8%AF%AD%E8%A8%80%E5%A4%84%E7%90%861/"><div class="card-body"> <em class="small" data-ts="1746514856" data-df="YYYY-MM-DD" > 2025-05-06 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>【NLP入门趣味题】探索语言模型与词向量</h3><div class="text-muted small"><p> 【NLP入门趣味题】探索语言模型与词向量 题目名称： “猜猜我是谁？——用词向量玩文字游戏” 🎯 任务目标 理解语言模型（Language Model）的基本概念——它能预测下一个词是什么！ 认识词向量（Word Embedding）——让计算机”看懂”词语的数学表达。 通过简单代码体验语义相似度，感受AI如何理解词语关系。 🔍 题目内容 假设你有一个超级简单的...</p></div></div></a></div><div class="card"> <a href="/posts/RAG%E6%A3%80%E7%B4%A2%E7%9F%A5%E8%AF%86%E5%A2%9E%E5%BC%BA/"><div class="card-body"> <em class="small" data-ts="1708444800" data-df="YYYY-MM-DD" > 2024-02-21 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>RAG</h3><div class="text-muted small"><p> RAG检索知识增强 不完全手册 本文从k个角度对RAG技术进行综述，第一个角度是“范式演变”，即原始的“朴素RAG”-“进阶RAG”-“模块化RAG”，这个角度个人认为是工程的角度、宏观的角度；第二个角度是“关键问题和相关研究”，大类上可分两类“以优化生成模型的表征空间为目的”和“以优化知识密集型问答任务为目的”。 通常“以优化生成模型的表征空间为目的”的这些模型有几个特点：（1）检...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/%E4%BD%8D%E7%BD%AE%E7%BC%96%E7%A0%81/" class="btn btn-outline-primary" prompt="上一篇"><p>深入研究BERT位置编码的原理</p></a> <a href="/posts/paddle%E5%90%88%E9%9B%86/" class="btn btn-outline-primary" prompt="下一篇"><p>Paddle写代码踩坑记录</p></a></div><script src="https://utteranc.es/client.js" repo="zoeChen119/zoeChen119.github.io" issue-term="title" crossorigin="anonymous" async> </script> <script type="text/javascript"> $(function() { const origin = "https://utteranc.es"; const iframe = "iframe.utterances-frame"; const lightTheme = "github-light"; const darkTheme = "github-dark"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } addEventListener("message", (event) => { let theme; /* credit to <https://github.com/utterance/utterances/issues/170#issuecomment-594036347> */ if (event.origin === origin) { /* page initial */ theme = initTheme; } else if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); } else { return; } const message = { type: "set-theme", theme: theme }; const utterances = document.querySelector(iframe).contentWindow; utterances.postMessage(message, origin); }); }); </script></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/zoeChen119">陈政伊</a>. <span data-toggle="tooltip" data-placement="top" title="除非另有说明，本网站上的博客文章均由作者按照知识共享署名 4.0 国际 (CC BY 4.0) 许可协议进行授权。">保留部分权利。</span></p></div><div class="footer-right"><p class="mb-0"> 本站由 <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> 生成，采用 <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> 主题。</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">热门标签</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/nlp/">nlp</a> <a class="post-tag" href="/tags/%E6%8A%80%E6%9C%AF%E7%BB%BC%E8%BF%B0/">技术综述</a> <a class="post-tag" href="/tags/%E8%AE%BA%E6%96%87%E7%AC%94%E8%AE%B0/">论文笔记</a> <a class="post-tag" href="/tags/rag/">RAG</a> <a class="post-tag" href="/tags/%E8%AF%AD%E8%A8%80%E5%AD%A6/">语言学</a> <a class="post-tag" href="/tags/%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B/">预训练模型</a> <a class="post-tag" href="/tags/bert/">BERT</a> <a class="post-tag" href="/tags/courses/">Courses</a> <a class="post-tag" href="/tags/chatgpt/">ChatGPT</a> <a class="post-tag" href="/tags/mamba/">Mamba</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">发现新版本的内容。</p><button type="button" class="btn btn-primary" aria-label="Update"> 更新 </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">搜索结果为空</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/zh.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
